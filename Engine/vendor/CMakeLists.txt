cmake_minimum_required(VERSION 3.26.0)
project(MalicEngine CXX C)

include(ExternalProject)

if (UNIX)
    find_package(ZLIB REQUIRED)
    find_package(X11 REQUIRED)
    set(LIB lib64)
elseif (WIN32)
    set(LIB lib)
endif ()

set(GLFW_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/extern/glfw CACHE INTERNAL "")
message("${GLFW_INSTALL_DIR}")
ExternalProject_Add(
    GLFW_EXTERN
    PREFIX ${GLFW_INSTALL_DIR}
    GIT_REPOSITORY https://github.com/glfw/glfw.git
    GIT_TAG e7ea71be039836da3a98cea55ae5569cb5eb885c
    UPDATE_DISCONNECTED TRUE
    CMAKE_ARGS
        -DCMAKE_INSTALL_PREFIX:PATH=${GLFW_INSTALL_DIR}/install
        -DGLFW_BUILD_DOCS:BOOL=OFF
        -DGLFW_BUILD_TESTS:BOOL=OFF
        -DGLFW_BUILD_EXAMPLES:BOOL=OFF
        -DGLFW_INSTALL:BOOL=ON
        -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
        -DGLFW_INCLUDE_VULKAN=ON
        -DGLFW_BUILD_X11:BOOL=OFF
        -DGLFW_BUILD_WAYLAND:BOOL=ON
        -DGLFW_VULKAN_STATIC=ON
        # -DGLFW_INCLUDE_NONE=ON
)
add_library(GLFW_LIBRARY STATIC IMPORTED)
set_target_properties(GLFW_LIBRARY PROPERTIES IMPORTED_LOCATION ${GLFW_INSTALL_DIR}/install/${LIB}/${CMAKE_STATIC_LIBRARY_PREFIX}glfw${CMAKE_STATIC_LIBRARY_SUFFIX})

set(GLM_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/extern/glm CACHE INTERNAL "")
ExternalProject_Add(
    GLM_EXTERN
    PREFIX ${GLM_INSTALL_DIR}
    GIT_REPOSITORY https://github.com/g-truc/glm.git
    GIT_TAG 2d4c4b4dd31fde06cfffad7915c2b3006402322f
    UPDATE_DISCONNECTED TRUE
    CMAKE_ARGS
        -DCMAKE_INSTALL_PREFIX:PATH=${GLM_INSTALL_DIR}/install
        -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
)
add_library(GLM_LIBRARY STATIC IMPORTED)
set_target_properties(GLM_LIBRARY PROPERTIES IMPORTED_LOCATION ${GLM_INSTALL_DIR}/install/${LIB}/${CMAKE_STATIC_LIBRARY_PREFIX}glm${CMAKE_STATIC_LIBRARY_SUFFIX})

set(FMT_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/extern/fmt CACHE INTERNAL "")
ExternalProject_Add(
    FMT_EXTERN
    PREFIX ${FMT_INSTALL_DIR}
    GIT_REPOSITORY https://github.com/fmtlib/fmt.git
    GIT_TAG 123913715afeb8a437e6388b4473fcc4753e1c9a
    UPDATE_DISCONNECTED TRUE
    CMAKE_ARGS
        -DCMAKE_INSTALL_PREFIX:PATH=${FMT_INSTALL_DIR}/install
        -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
)
add_library(FMT_LIBRARY STATIC IMPORTED)
set_target_properties(FMT_LIBRARY PROPERTIES IMPORTED_LOCATION ${FMT_INSTALL_DIR}/install/${LIB}/${CMAKE_STATIC_LIBRARY_PREFIX}fmt${CMAKE_STATIC_LIBRARY_SUFFIX})

# set(ASSIMP_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/extern/assimp CACHE INTERNAL "")
# ExternalProject_Add(
#     ASSIMP_EXTERN
#     PREFIX ${ASSIMP_INSTALL_DIR}
#     GIT_REPOSITORY https://github.com/assimp/assimp.git
#     GIT_TAG a93b9f8c80a23dc019d440c4f78132b7e899ea94
#     UPDATE_DISCONNECTED TRUE
#     CMAKE_ARGS
#         -DCMAKE_INSTALL_PREFIX:PATH=${ASSIMP_INSTALL_DIR}/install
#         -DASSIMP_NO_EXPORT:BOOL=OFF
#         -DASSIMP_BUILD_SAMPLES:BOOL=OFF
#         -DBUILD_SHARED_LIBS:BOOL=OFF
#         -DASSIMP_BUILD_ALL_EXPORTERS_BY_DEFAULT:BOOL=OFF
#         -DASSIMP_BUILD_TESTS:BOOL=OFF
#         -DASSIMP_BUILD_ASSIMP_VIEW:BOOL=OFF
#         -DASSIMP_BUILD_ASSIMP_TOOLS:BOOL=OFF
#         -DASSIMP_INSTALL:BOOL=ON
#         -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
# )
# add_library(ASSIMP_LIBRARY STATIC IMPORTED)
# set_target_properties(ASSIMP_LIBRARY PROPERTIES IMPORTED_LOCATION ${ASSIMP_INSTALL_DIR}/install/${LIB}/${CMAKE_STATIC_LIBRARY_PREFIX}assimp${CMAKE_STATIC_LIBRARY_SUFFIX})
# set_property(TARGET ASSIMP_LIBRARY PROPERTY COMPILE_WARNING_AS_ERROR OFF)
